---
title: api reference
description: comprehensive api documentation for arbor
---

# api reference

arbor provides restful apis and rpc endpoints for all platform features.

## base urls

<Tabs>
  <Tab title="production">
    ```
    https://arbor.app/api
    ```
  </Tab>
  <Tab title="development">
    ```
    http://localhost:3000/api
    ```
  </Tab>
</Tabs>

## authentication

all api endpoints require authentication via clerk.

<CodeGroup>
```typescript headers
{
  "Authorization": "Bearer <clerk-token>",
  "Content-Type": "application/json"
}
```

```typescript middleware
import { clerkMiddleware } from '@clerk/nextjs/server';

export default clerkMiddleware({
  publicRoutes: ['/api/health', '/api/openapi']
});
```
</CodeGroup>

## endpoints

### chat operations

#### stream chat

<Card title="POST /api/chat/stream" icon="message">
  stream ai responses for chat conversations.
  
  **request body:**
  ```json
  {
    "messages": [
      {
        "role": "user",
        "content": "hello, how are you?"
      }
    ],
    "model": "gpt-4o", // optional
    "temperature": 0.7, // optional
    "tools": [] // optional
  }
  ```
  
  **response:**
  ```
  event: message
  data: {"content": "Hello! I'm doing well, thank you..."}
  
  event: done
  data: [DONE]
  ```
  
  **status codes:**
  - `200`: success (streaming)
  - `400`: invalid request
  - `401`: unauthorized
  - `500`: server error
</Card>

#### get chat history

<Card title="GET /api/chats" icon="clock">
  retrieve user's chat history.
  
  **query parameters:**
  - `limit` (number): max results (default: 20)
  - `offset` (number): pagination offset
  - `projectId` (string): filter by project
  
  **response:**
  ```json
  {
    "chats": [
      {
        "id": "chat_123",
        "title": "project discussion",
        "createdAt": "2024-01-01T00:00:00Z",
        "updatedAt": "2024-01-01T00:00:00Z",
        "messageCount": 10,
        "projectId": "proj_456"
      }
    ],
    "total": 50,
    "hasMore": true
  }
  ```
</Card>

#### create chat

<Card title="POST /api/chats" icon="plus">
  create new chat session.
  
  **request body:**
  ```json
  {
    "title": "new chat",
    "projectId": "proj_456", // optional
    "model": "gpt-4o" // optional
  }
  ```
  
  **response:**
  ```json
  {
    "id": "chat_789",
    "title": "new chat",
    "threadId": "thread_abc",
    "createdAt": "2024-01-01T00:00:00Z"
  }
  ```
</Card>

### project management

#### list projects

<Card title="GET /api/projects" icon="folder">
  get user's projects.
  
  **response:**
  ```json
  {
    "projects": [
      {
        "id": "proj_123",
        "name": "my project",
        "description": "project description",
        "createdAt": "2024-01-01T00:00:00Z",
        "chatCount": 5
      }
    ]
  }
  ```
</Card>

#### create project

<Card title="POST /api/projects" icon="folder-plus">
  create new project.
  
  **request body:**
  ```json
  {
    "name": "new project",
    "description": "project description"
  }
  ```
  
  **response:**
  ```json
  {
    "id": "proj_456",
    "name": "new project",
    "description": "project description",
    "createdAt": "2024-01-01T00:00:00Z"
  }
  ```
</Card>

### workspace operations

#### list workspaces

<Card title="GET /api/workspaces" icon="briefcase">
  get code workspaces.
  
  **response:**
  ```json
  {
    "workspaces": [
      {
        "id": "ws_123",
        "name": "main workspace",
        "path": "/projects/arbor",
        "createdAt": "2024-01-01T00:00:00Z",
        "taskCount": 10
      }
    ]
  }
  ```
</Card>

#### create task

<Card title="POST /api/tasks" icon="check-square">
  create workspace task.
  
  **request body:**
  ```json
  {
    "workspaceId": "ws_123",
    "title": "implement feature",
    "description": "detailed description",
    "status": "pending"
  }
  ```
  
  **response:**
  ```json
  {
    "id": "task_456",
    "title": "implement feature",
    "status": "pending",
    "createdAt": "2024-01-01T00:00:00Z"
  }
  ```
</Card>

### user management

#### get profile

<Card title="GET /api/users/me" icon="user">
  get current user profile.
  
  **response:**
  ```json
  {
    "id": "user_123",
    "email": "user@example.com",
    "name": "john doe",
    "settings": {
      "theme": "dark",
      "defaultModel": "gpt-4o"
    }
  }
  ```
</Card>

#### update settings

<Card title="PATCH /api/users/settings" icon="cog">
  update user settings.
  
  **request body:**
  ```json
  {
    "theme": "light",
    "defaultModel": "claude-3-opus",
    "aiProvider": "anthropic"
  }
  ```
  
  **response:**
  ```json
  {
    "success": true,
    "settings": {
      "theme": "light",
      "defaultModel": "claude-3-opus"
    }
  }
  ```
</Card>

### ai models

#### list available models

<Card title="GET /api/models" icon="robot">
  get available ai models.
  
  **response:**
  ```json
  {
    "models": [
      {
        "id": "gpt-4o",
        "name": "GPT-4 Optimized",
        "provider": "openai",
        "contextLength": 128000,
        "capabilities": ["chat", "tools", "vision"]
      },
      {
        "id": "claude-3-opus",
        "name": "Claude 3 Opus",
        "provider": "anthropic",
        "contextLength": 200000,
        "capabilities": ["chat", "tools"]
      }
    ]
  }
  ```
</Card>

### health & status

#### health check

<Card title="GET /api/health" icon="heart">
  check api health status.
  
  **response:**
  ```json
  {
    "status": "healthy",
    "timestamp": "2024-01-01T00:00:00Z",
    "services": {
      "database": "connected",
      "ai": "connected",
      "cache": "connected"
    }
  }
  ```
</Card>

#### openapi spec

<Card title="GET /api/openapi" icon="book">
  get openapi specification.
  
  **response:**
  ```json
  {
    "openapi": "3.0.0",
    "info": {
      "title": "arbor api",
      "version": "1.0.0"
    },
    "paths": {
      ...
    }
  }
  ```
</Card>

## orpc endpoints

arbor uses orpc for type-safe rpc calls.

### client usage

```typescript
import { client } from '@/lib/orpc-client';

// type-safe api calls
const chats = await client.chat.list.query();
const result = await client.chat.create.mutate({
  title: 'new chat'
});
```

### available procedures

<Tabs>
  <Tab title="chat">
    ```typescript
    // queries
    client.chat.list.query()
    client.chat.get.query({ id })
    client.chat.messages.query({ chatId })
    
    // mutations
    client.chat.create.mutate({ title })
    client.chat.update.mutate({ id, title })
    client.chat.delete.mutate({ id })
    ```
  </Tab>
  
  <Tab title="project">
    ```typescript
    // queries
    client.project.list.query()
    client.project.get.query({ id })
    
    // mutations
    client.project.create.mutate({ name })
    client.project.update.mutate({ id, name })
    client.project.delete.mutate({ id })
    ```
  </Tab>
  
  <Tab title="user">
    ```typescript
    // queries
    client.user.me.query()
    client.user.settings.query()
    
    // mutations
    client.user.updateSettings.mutate({ theme })
    client.user.updateProfile.mutate({ name })
    ```
  </Tab>
</Tabs>

## error handling

### error response format

```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "invalid input",
    "details": {
      "field": "email",
      "reason": "invalid format"
    }
  }
}
```

### common error codes

| code | status | description |
|------|--------|-------------|
| `UNAUTHORIZED` | 401 | missing or invalid auth |
| `FORBIDDEN` | 403 | insufficient permissions |
| `NOT_FOUND` | 404 | resource not found |
| `VALIDATION_ERROR` | 400 | invalid input data |
| `RATE_LIMITED` | 429 | too many requests |
| `SERVER_ERROR` | 500 | internal server error |

## rate limiting

api endpoints are rate-limited per user:

| endpoint | limit | window |
|----------|-------|--------|
| `/api/chat/stream` | 100 | 1 minute |
| `/api/chats` | 1000 | 1 minute |
| `/api/projects` | 500 | 1 minute |
| other endpoints | 200 | 1 minute |

rate limit headers:
```
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 95
X-RateLimit-Reset: 1704067200
```

## webhooks

### clerk webhooks

<Card title="POST /api/webhooks/clerk" icon="webhook">
  handle clerk user events.
  
  **events:**
  - `user.created`
  - `user.updated`
  - `user.deleted`
  
  **verification:**
  ```typescript
  import { Webhook } from 'svix';
  
  const webhook = new Webhook(CLERK_WEBHOOK_SECRET);
  const verified = webhook.verify(body, headers);
  ```
</Card>

## sdk usage

### typescript/javascript

```bash
pnpm add @arbor/sdk
```

```typescript
import { ArborClient } from '@arbor/sdk';

const client = new ArborClient({
  apiKey: process.env.ARBOR_API_KEY,
  baseUrl: 'https://arbor.app/api'
});

// use the client
const chats = await client.chats.list();
const stream = await client.chat.stream({
  messages: [{ role: 'user', content: 'hello' }]
});
```

### python

```python
from arbor import ArborClient

client = ArborClient(
  api_key="your-api-key",
  base_url="https://arbor.app/api"
)

# use the client
chats = client.chats.list()
stream = client.chat.stream(
  messages=[{"role": "user", "content": "hello"}]
)
```

## testing

### postman collection

download the [postman collection](/api/postman.json) for testing.

### curl examples

```bash
# health check
curl https://arbor.app/api/health

# create chat (with auth)
curl -X POST https://arbor.app/api/chats \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{"title": "new chat"}'

# stream chat
curl -X POST https://arbor.app/api/chat/stream \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{"messages": [{"role": "user", "content": "hello"}]}'
```

## changelog

### v1.0.0 (current)
- initial api release
- chat streaming endpoint
- project management
- user settings
- orpc integration

## support

<CardGroup cols={2}>
  <Card title="github issues" icon="github" href="https://github.com/lnittman/arbor/issues">
    report bugs and request features
  </Card>
  
  <Card title="discord" icon="discord" href="https://discord.gg/arbor">
    get help from the community
  </Card>
</CardGroup>